# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: 401 –Ω–∞ POST /api/v1/token/

## ‚úÖ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ `backend/users/views.py`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç `AuthenticationFailed` (–æ—Ç SimpleJWT)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç `APIException` (–¥—Ä—É–≥–∏–µ API –æ—à–∏–±–∫–∏)
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫

### 2. –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `backend/users/serializers.py`
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ (username, phone, email)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ phone/email/username)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –º–µ—Ç–æ–¥–µ `validate()`

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:**

```bash
cd /root/ringo-uchet/backend

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ API –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
docker compose -f docker-compose.prod.yml restart api

# –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose -f docker-compose.prod.yml logs -f api
```

**–ó–∞—Ç–µ–º –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏.**

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö:**

1. **`Token obtain attempt`** - —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è (phone, email, username)
2. **`Phone normalized`** - –∫–∞–∫ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è —Ç–µ–ª–µ—Ñ–æ–Ω
3. **`User found by phone/email/username`** - –Ω–∞–π–¥–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
4. **`User not found`** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω (–Ω–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
5. **`Invalid password`** - –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å
6. **`Inactive user`** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω
7. **`Token generated successfully`** - —Ç–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω
8. **`Error in parent validate()`** - –æ—à–∏–±–∫–∞ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –º–µ—Ç–æ–¥–µ

---

## üîç –ü–†–û–í–ï–†–ö–ê: –ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å–µ

**–í –±—Ä–∞—É–∑–µ—Ä–µ (DevTools):**

1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://ringoouchet.ru`
2. `F12` ‚Üí **Network**
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏
4. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å `POST /api/v1/token/`
5. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - **Payload** (—á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è):
     ```json
     {
       "phone": "79187020987",
       "password": "alik123"
     }
     ```
   - **Response** (—á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä):
     - –ï—Å–ª–∏ 401 - –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ `detail` –≤ –æ—Ç–≤–µ—Ç–µ
     - –ï—Å–ª–∏ 200 - —Ç–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ

---

## üîç –ü–†–û–í–ï–†–ö–ê: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
cd /root/ringo-uchet/backend

docker compose -f docker-compose.prod.yml exec -T api python -c "
import os
import django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'ringo_backend.settings.prod')
django.setup()

from users.models import User

print('=== –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ===')
for u in User.objects.all():
    print(f'ID: {u.id}')
    print(f'  –¢–µ–ª–µ—Ñ–æ–Ω: {u.phone or \"–ù–ï–¢\"}')
    print(f'  Email: {u.email or \"–ù–ï–¢\"}')
    print(f'  Username: {u.username}')
    print(f'  –ê–∫—Ç–∏–≤–µ–Ω: {u.is_active}')
    print(f'  –†–æ–ª—å: {u.role}')
    print('---')
"
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
- –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –Ω—É–∂–Ω—ã–º —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º/email?
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –ë–î?
- –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (`is_active=True`)?

---

## üîç –¢–ï–°–¢–û–í–´–ô –ó–ê–ü–†–û–° —Å —Å–µ—Ä–≤–µ—Ä–∞

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
curl -X POST https://ringoouchet.ru/api/v1/token/ \
  -H "Content-Type: application/json" \
  -d '{"phone": "79187020987", "password": "alik123"}' \
  -v
```

**–ó–∞–º–µ–Ω–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –ø–∞—Ä–æ–ª—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ.**

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–≤–µ—Ç:**
- –ï—Å–ª–∏ 401 - –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —á—Ç–æ –≤ –æ—Ç–≤–µ—Ç–µ (`detail`)
- –ï—Å–ª–∏ 200 - –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–ª–∏–µ–Ω—Ç–µ (Flutter)

---

## üîß –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´ 401

1. **–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω/email
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞**
   - –¢–µ–ª–µ—Ñ–æ–Ω –≤ –ë–î: `79187020987`
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è: `+79187020987` –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç
   - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω**
   - `is_active=False` –≤ –ë–î

4. **–û—à–∏–±–∫–∞ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –º–µ—Ç–æ–¥–µ `validate()`**
   - –ü—Ä–æ–±–ª–µ–º–∞ —Å SimpleJWT
   - –ü—Ä–æ–±–ª–µ–º–∞ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Ç–æ–∫–µ–Ω–æ–≤

---

## ‚úÖ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ API** (—á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è)
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î**
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å–µ** (DevTools)
5. **–ü—Ä–∏—à–ª–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** - —è –ø–æ–º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è!

---

**–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ª–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç —Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É 401 –æ—à–∏–±–∫–∏!**

