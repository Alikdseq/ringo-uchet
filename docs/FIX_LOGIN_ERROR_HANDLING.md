# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û—à–∏–±–∫–∞ 500 –≤–º–µ—Å—Ç–æ 401 –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê

**–û—à–∏–±–∫–∞:** Django –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500 –≤–º–µ—Å—Ç–æ 401 –ø—Ä–∏ –Ω–µ–≤–µ—Ä–Ω—ã—Ö —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö!

**–í –ª–æ–≥–∞—Ö:**
```
Error in token obtain: {'detail': [ErrorDetail(string='–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω, email –∏–ª–∏ –ø–∞—Ä–æ–ª—å', code='invalid')]}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `CustomTokenObtainPairView` –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500!

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–û–±–Ω–æ–≤–∏–ª `backend/users/views.py` - —Ç–µ–ø–µ—Ä—å ValidationError –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401!**

---

## ‚úÖ –®–ê–ì 1: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å API

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
cd /root/ringo-uchet/backend

# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Docker –æ–±—Ä–∞–∑, –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ
# docker compose -f docker-compose.prod.yml build api

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose -f docker-compose.prod.yml up -d api

# –ü–æ–¥–æ–∂–¥–∞—Ç—å
sleep 5

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
docker compose -f docker-compose.prod.yml ps api
```

---

## ‚úÖ –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑–µ

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
cd /root/ringo-uchet/backend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –µ—Å—Ç—å –≤ –±–∞–∑–µ
docker compose -f docker-compose.prod.yml exec api python manage.py shell << 'PYTHON'
from users.models import User
users = User.objects.all()
print(f"–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {users.count()}")
for user in users:
    print(f"- {user.phone} ({user.email or '–Ω–µ—Ç email'}) - —Ä–æ–ª—å: {user.role}")
PYTHON
```

**–ü—Ä–∏—à–ª–∏—Ç–µ –≤—ã–≤–æ–¥!**

---

## ‚úÖ –®–ê–ì 3: –¢–µ—Å—Ç –ª–æ–≥–∏–Ω–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã!
curl -k -X POST https://ringoouchet.ru/api/v1/token/ \
  -H "Content-Type: application/json" \
  -H "Origin: https://ringoouchet.ru" \
  -d '{"phone":"–†–ï–ê–õ–¨–ù–´–ô_–¢–ï–õ–ï–§–û–ù","password":"–†–ï–ê–õ–¨–ù–´–ô_–ü–ê–†–û–õ–¨"}' \
  2>&1 | grep -E "< HTTP|token|error|detail|access"
```

**–¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- 401 (–µ—Å–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ) –≤–º–µ—Å—Ç–æ 500 ‚úÖ
- 200 —Å —Ç–æ–∫–µ–Ω–∞–º–∏ (–µ—Å–ª–∏ –≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ) ‚úÖ

---

**–í—ã–ø–æ–ª–Ω–∏—Ç–µ –®–ê–ì–ò 1-3 –∏ –ø—Ä–∏—à–ª–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!**

