# Penetration Testing Checklist для Ringo Uchet

Чеклист для проведения penetration testing согласно OWASP стандартам.

## Общая информация

**Проект:** Ringo Uchet  
**Дата тестирования:** [ДАТА]  
**Тестировщик:** [ИМЯ]  
**Версия API:** v1  
**Окружение:** Production / Staging

## 1. OWASP API Security Top 10

### API1:2019 Broken Object Level Authorization

**Тесты:**

- [ ] Попытка доступа к чужому заказу
  ```bash
  curl -H "Authorization: Bearer $TOKEN" \
    https://api.ringo.example.com/api/v1/orders/999/
  # Ожидается: 403 или 404
  ```

- [ ] Попытка изменения чужого заказа
  ```bash
  curl -X PATCH -H "Authorization: Bearer $TOKEN" \
    https://api.ringo.example.com/api/v1/orders/999/ \
    -d '{"status": "COMPLETED"}'
  # Ожидается: 403
  ```

- [ ] Попытка доступа к чужим финансовым данным
  ```bash
  curl -H "Authorization: Bearer $OPERATOR_TOKEN" \
    https://api.ringo.example.com/api/v1/reports/summary/
  # Ожидается: 403 (только для admin)
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

---

### API2:2019 Broken Authentication

**Тесты:**

- [ ] Брутфорс атака на логин
  ```bash
  for i in {1..100}; do
    curl -X POST https://api.ringo.example.com/api/v1/token/ \
      -d "phone=+79991234567&password=wrong$i"
  done
  # Ожидается: Rate limiting после 5-10 попыток
  ```

- [ ] Попытка использования истекшего токена
  ```bash
  curl -H "Authorization: Bearer $EXPIRED_TOKEN" \
    https://api.ringo.example.com/api/v1/orders/
  # Ожидается: 401
  ```

- [ ] Попытка подделки JWT токена
  ```bash
  # Изменить payload токена
  curl -H "Authorization: Bearer $MODIFIED_TOKEN" \
    https://api.ringo.example.com/api/v1/orders/
  # Ожидается: 401 (невалидная подпись)
  ```

- [ ] Попытка использования refresh token как access token
  ```bash
  curl -H "Authorization: Bearer $REFRESH_TOKEN" \
    https://api.ringo.example.com/api/v1/orders/
  # Ожидается: 401
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

---

### API3:2019 Excessive Data Exposure

**Тесты:**

- [ ] Проверка, что пароли не возвращаются в API
  ```bash
  curl -H "Authorization: Bearer $TOKEN" \
    https://api.ringo.example.com/api/v1/users/me/
  # Ожидается: нет поля password
  ```

- [ ] Проверка, что секретные ключи не возвращаются
  ```bash
  curl -H "Authorization: Bearer $TOKEN" \
    https://api.ringo.example.com/api/v1/settings/
  # Ожидается: нет секретных данных
  ```

- [ ] Проверка, что внутренние ID не раскрываются
  ```bash
  curl -H "Authorization: Bearer $TOKEN" \
    https://api.ringo.example.com/api/v1/orders/
  # Ожидается: только необходимые поля
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

---

### API4:2019 Lack of Resources & Rate Limiting

**Тесты:**

- [ ] Отправка большого количества запросов
  ```bash
  for i in {1..1000}; do
    curl -H "Authorization: Bearer $TOKEN" \
      https://api.ringo.example.com/api/v1/orders/ &
  done
  # Ожидается: Rate limiting
  ```

- [ ] Отправка большого запроса (DoS)
  ```bash
  dd if=/dev/zero bs=100M count=1 | curl -X POST \
    https://api.ringo.example.com/api/v1/orders/ \
    -H "Authorization: Bearer $TOKEN" \
    --data-binary @-
  # Ожидается: 413 Request Entity Too Large
  ```

- [ ] Глубокий вложенный JSON
  ```bash
  curl -X POST https://api.ringo.example.com/api/v1/orders/ \
    -H "Authorization: Bearer $TOKEN" \
    -d '{"data": {"nested": {"deep": {"very": {"deep": {...}}}}}}'
  # Ожидается: Валидация и ограничение глубины
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

---

### API5:2019 Broken Function Level Authorization

**Тесты:**

- [ ] Оператор пытается создать заказ
  ```bash
  curl -X POST -H "Authorization: Bearer $OPERATOR_TOKEN" \
    https://api.ringo.example.com/api/v1/orders/ \
    -d '{"client": 1, "equipment": [1]}'
  # Ожидается: 403 (только manager может создавать)
  ```

- [ ] Менеджер пытается получить финансовые отчеты
  ```bash
  curl -H "Authorization: Bearer $MANAGER_TOKEN" \
    https://api.ringo.example.com/api/v1/reports/summary/
  # Ожидается: 403 (только admin)
  ```

- [ ] Попытка доступа к admin панели без прав
  ```bash
  curl -H "Authorization: Bearer $OPERATOR_TOKEN" \
    https://api.ringo.example.com/admin/
  # Ожидается: 403 или редирект
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

---

### API6:2019 Mass Assignment

**Тесты:**

- [ ] Попытка изменить role через API
  ```bash
  curl -X PATCH -H "Authorization: Bearer $TOKEN" \
    https://api.ringo.example.com/api/v1/users/123/ \
    -d '{"role": "admin"}'
  # Ожидается: Поле role игнорируется
  ```

- [ ] Попытка изменить внутренние поля
  ```bash
  curl -X PATCH -H "Authorization: Bearer $TOKEN" \
    https://api.ringo.example.com/api/v1/orders/123/ \
    -d '{"created_at": "2020-01-01", "total_amount": 0}'
  # Ожидается: Поля не изменяются
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

---

### API7:2019 Security Misconfiguration

**Тесты:**

- [ ] Проверка DEBUG режима
  ```bash
  curl https://api.ringo.example.com/api/v1/orders/?debug=1
  # Ожидается: Нет детальной информации об ошибках
  ```

- [ ] Проверка security headers
  ```bash
  curl -I https://api.ringo.example.com/api/v1/
  # Ожидается: Strict-Transport-Security, X-Frame-Options, etc.
  ```

- [ ] Проверка CORS настроек
  ```bash
  curl -H "Origin: https://evil.com" \
    -H "Access-Control-Request-Method: POST" \
    -X OPTIONS https://api.ringo.example.com/api/v1/orders/
  # Ожидается: Нет Access-Control-Allow-Origin для evil.com
  ```

- [ ] Проверка версии сервера
  ```bash
  curl -I https://api.ringo.example.com/api/v1/
  # Ожидается: Нет заголовка Server или скрыта версия
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

---

### API8:2019 Injection

#### SQL Injection

**Тесты:**

- [ ] SQL injection в query параметрах
  ```bash
  curl "https://api.ringo.example.com/api/v1/orders/?id=1' OR '1'='1"
  curl "https://api.ringo.example.com/api/v1/orders/?id=1; DROP TABLE orders;"
  # Ожидается: Валидация или экранирование
  ```

- [ ] SQL injection в POST данных
  ```bash
  curl -X POST https://api.ringo.example.com/api/v1/orders/ \
    -H "Authorization: Bearer $TOKEN" \
    -d '{"client": "1'\'' OR '\''1'\''='\''1"}'
  # Ожидается: Валидация
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

#### XSS (Cross-Site Scripting)

**Тесты:**

- [ ] XSS в query параметрах
  ```bash
  curl "https://api.ringo.example.com/api/v1/orders/?search=<script>alert(1)</script>"
  # Ожидается: Экранирование или блокировка
  ```

- [ ] XSS в POST данных
  ```bash
  curl -X POST https://api.ringo.example.com/api/v1/orders/ \
    -H "Authorization: Bearer $TOKEN" \
    -d '{"description": "<script>alert(1)</script>"}'
  # Ожидается: Санитизация
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

#### Command Injection

**Тесты:**

- [ ] Command injection в параметрах
  ```bash
  curl "https://api.ringo.example.com/api/v1/orders/?file=; cat /etc/passwd"
  # Ожидается: Валидация
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

---

### API9:2019 Improper Assets Management

**Тесты:**

- [ ] Доступ к устаревшим версиям API
  ```bash
  curl https://api.ringo.example.com/api/v0/orders/
  # Ожидается: 404 или редирект на v1
  ```

- [ ] Доступ к тестовым endpoints
  ```bash
  curl https://api.ringo.example.com/api/test/orders/
  # Ожидается: Недоступен в production
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

---

### API10:2019 Insufficient Logging & Monitoring

**Тесты:**

- [ ] Проверка логирования неудачных попыток входа
  ```bash
  curl -X POST https://api.ringo.example.com/api/v1/token/ \
    -d "phone=+79991234567&password=wrong"
  # Ожидается: Запись в security логах
  ```

- [ ] Проверка логирования подозрительной активности
  ```bash
  curl "https://api.ringo.example.com/api/v1/orders/?id=1' OR '1'='1"
  # Ожидается: Запись в security логах
  ```

- [ ] Проверка мониторинга
  ```bash
  # Проверить Prometheus метрики
  curl http://localhost:9090/api/v1/query?query=errors_total
  # Ожидается: Метрики доступны
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

---

## 2. Дополнительные тесты безопасности

### SSRF (Server-Side Request Forgery)

**Тесты:**

- [ ] SSRF через URL параметр
  ```bash
  curl "https://api.ringo.example.com/api/v1/webhook/?url=http://127.0.0.1:5432"
  curl "https://api.ringo.example.com/api/v1/webhook/?url=http://169.254.169.254/latest/meta-data/"
  # Ожидается: Блокировка внутренних IP
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

### Path Traversal

**Тесты:**

- [ ] Попытка доступа к файлам вне директории
  ```bash
  curl "https://api.ringo.example.com/api/v1/files/../../../etc/passwd"
  # Ожидается: Валидация пути
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

### IDOR (Insecure Direct Object Reference)

**Тесты:**

- [ ] Попытка доступа к объекту через предсказуемый ID
  ```bash
  for id in {1..100}; do
    curl -H "Authorization: Bearer $TOKEN" \
      https://api.ringo.example.com/api/v1/orders/$id/
  done
  # Ожидается: Проверка прав доступа
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

### CSRF (Cross-Site Request Forgery)

**Тесты:**

- [ ] Попытка CSRF атаки
  ```bash
  # Создать HTML форму на внешнем сайте
  # Попытаться выполнить действие от имени пользователя
  # Ожидается: CSRF token проверка
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

## 3. Инфраструктурная безопасность

### SSL/TLS

- [ ] Проверка SSL сертификата
  ```bash
  openssl s_client -connect api.ringo.example.com:443
  # Ожидается: Валидный сертификат, TLS 1.2+
  ```

- [ ] Проверка через SSL Labs
  - [ ] Grade A или выше
  - [ ] HSTS включен
  - [ ] Современные cipher suites

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

### Firewall

- [ ] Проверка открытых портов
  ```bash
  nmap -p- api.ringo.example.com
  # Ожидается: Только 80, 443, возможно 22
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

### IP Allowlist

- [ ] Попытка доступа к admin из неразрешенного IP
  ```bash
  curl https://api.ringo.example.com/admin/
  # Ожидается: 403 или редирект
  ```

**Результат:** [ ] PASS [ ] FAIL  
**Комментарии:** ________________

## Итоговый отчет

**Общее количество тестов:** _____  
**Пройдено:** _____  
**Провалено:** _____  
**Критичных уязвимостей:** _____  
**Высоких уязвимостей:** _____  
**Средних уязвимостей:** _____  
**Низких уязвимостей:** _____

**Рекомендации:**

1. ________________________________
2. ________________________________
3. ________________________________

**Подпись тестировщика:** ________________  
**Дата:** ________________

