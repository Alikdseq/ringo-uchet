## Пользовательские flow’ы

### 1. Менеджер: создание и сопровождение заявки
1. Авторизация в мобильном или веб-клиенте (JWT, роль `manager`).
2. Из дашборда выбирает «Создать заявку».
3. Заполняет:
   - Клиент (из справочника или новый контакт).
   - Адрес (поиск + карта + координаты).
   - Даты/время начала и окончания, SLA, пожелания клиента.
   - Состав: техника, услуги, материалы, навески (кол-ва, ставки).
   - Предоплата: требуемая сумма/процент.
4. Нажимает «Сохранить»: заявка получает статус `DRAFT`, рассчитывается snapshot стоимости.
5. Отправляет клиенту подтверждение (PDF/ссылка), переводит в `CREATED`.
6. При получении подтверждения переводит в `APPROVED`, назначает оператора и технику.
7. Отслеживает выполнение:
   - Получает push/email при смене статусов, загрузке фото оператором.
   - Может редактировать состав, добавлять комментарии.
8. После завершения оператора — проверяет фактические данные, инициирует генерацию PDF-акта/счёта.
9. Передаёт заказ в работу бухгалтеру/финансисту, следит за оплатами и отчётами.

### 2. Оператор: выполнение заказа и фотопротокол
1. Получает push о назначении (`CREATED`/`APPROVED` → ему присвоено `operator`).
2. Из списка «Мои задания» открывает карточку заказа, видит адрес, время, контакт менеджера.
3. В день работ:
   - Отмечает выезд (статус `IN_PROGRESS` — с комментарием/фото).
   - По прибытии делает фото «до», прикрепляет с GPS.
4. Во время/после работ:
   - Фиксирует расход материалов, доп. услуги, переработки.
   - При завершении загружает фото «после», меняет статус на `COMPLETED`, добавляет отчёт.
5. ЗП/статус выплат:
   - В профиле видит начисления `SalaryRecord`, комментарии по оплатам.

### 3. Бухгалтер / Финансист: финконтур
1. Список заявок в статусах `COMPLETED/APPROVED` с фильтрами по дате/клиенту.
2. Проверяет заполненные данные:
   - Цена, фактические часы, доп. расходы, penalty/discount.
   - Фото и документы.
3. Генерирует/скачивает PDF-счёт и акт (или отправляет клиенту по email).
4. Отмечает платежи (связь Payment ↔ Invoice), фиксирует даты/метод/комиссию.
5. Создаёт расходы (топливо, ремонт), привязку к технике.
6. Рассчитывает зарплаты операторов по заказам → подтверждает выплаты.
7. Формирует отчёты (фин, техника, сотрудники), экспортирует в CSV/XLSX/PDF.

### 4. Админ / Владелец
1. Доступ ко всему списку заявок, настройкам, пользователям, тарифам.
2. Управляет справочниками техники/услуг/материалов, ценами, налогами, штрафами.
3. Настраивает роли и права, приглашает новых пользователей.
4. Следит за KPI на дашборде: доходы, загрузка парка, SLA, долговая нагрузка.
5. Инициирует резервное копирование, аудит логов, настройку интеграций (S3, SMS, платежи).
6. Просматривает риски/инциденты, дает доступ QA/DevOps.

### 5. Публичный клиент (опционально)
1. Заходит на сайт, открывает форму «Заказать технику».
2. Вводит контактные данные, адрес, описание работ, предпочитаемые даты.
3. Нажимает «Отправить»: создаётся лид/заявка в статусе `DRAFT` (без цены).
4. Менеджер связывается, уточняет детали, переводит заявку в основной поток.

Flow’ы используются при проектировании UI, автоматизации тестов и определении acceptance criteria.

