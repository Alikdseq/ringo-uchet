# üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê: 401 –Ω–∞ POST /api/v1/token/

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê

**–û—à–∏–±–∫–∞:** `POST https://ringoouchet.ru/api/v1/token/ 401 (Unauthorized)`

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ —Å–∞–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ª–æ–≥–∏–Ω –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º.**

---

## ‚úÖ –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å–µ

**–í –±—Ä–∞—É–∑–µ—Ä–µ (DevTools):**

1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://ringoouchet.ru`
2. `F12` ‚Üí **Network**
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏
4. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å `POST /api/v1/token/`
5. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - **Payload** (—á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è):
     ```json
     {
       "phone": "79187020987",
       "password": "alik123"
     }
     ```
   - **Request Headers**
   - **Response** (—á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä)

---

## ‚úÖ –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
cd /root/ringo-uchet/backend
docker compose -f docker-compose.prod.yml logs -n 50 api | grep -i "token\|401\|error"
```

**–ò–ª–∏ –ø–æ–ª–Ω—ã–µ –ª–æ–≥–∏:**

```bash
docker compose -f docker-compose.prod.yml logs -n 100 api
```

---

## ‚úÖ –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
cd /root/ringo-uchet/backend

docker compose -f docker-compose.prod.yml exec -T api python -c "
import os
import django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'ringo_backend.settings.prod')
django.setup()

from users.models import User

print('=== –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ===')
for u in User.objects.all():
    print(f'ID: {u.id}')
    print(f'  –¢–µ–ª–µ—Ñ–æ–Ω: {u.phone or \"–ù–ï–¢\"}')
    print(f'  Email: {u.email or \"–ù–ï–¢\"}')
    print(f'  Username: {u.username}')
    print(f'  –ê–∫—Ç–∏–≤–µ–Ω: {u.is_active}')
    print(f'  –†–æ–ª—å: {u.role}')
    print('---')
"
```

---

## ‚úÖ –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.**

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
- –ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è: `79187020987` –∏–ª–∏ `+79187020987`?
- –ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î?

**–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω:**
- –£–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–±–µ–ª—ã, —Å–∫–æ–±–∫–∏, –¥–µ—Ñ–∏—Å—ã, –ø–ª—é—Å—ã
- –ï—Å–ª–∏ –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 7 –∏–ª–∏ 8, –¥–æ–±–∞–≤–ª—è–µ—Ç 7

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –¢–µ–ª–µ—Ñ–æ–Ω –≤ –ë–î —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ, –∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –¥—Ä—É–≥–æ–º.

---

## ‚úÖ –®–ê–ì 5: –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å —Å–µ—Ä–≤–µ—Ä–∞

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
curl -X POST https://ringoouchet.ru/api/v1/token/ \
  -H "Content-Type: application/json" \
  -d '{"phone": "79187020987", "password": "alik123"}' \
  -v
```

**–ó–∞–º–µ–Ω–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –ø–∞—Ä–æ–ª—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ.**

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–≤–µ—Ç:**
- –ï—Å–ª–∏ 401 - –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —á—Ç–æ –≤ –æ—Ç–≤–µ—Ç–µ (detail)
- –ï—Å–ª–∏ 200 - –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–ª–∏–µ–Ω—Ç–µ

---

## üîß –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´

1. **–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω/email
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω (`is_active=False`)

2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞**
   - –¢–µ–ª–µ—Ñ–æ–Ω –≤ –ë–î: `79187020987`
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è: `+79187020987` –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç
   - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–º**
   - –û—à–∏–±–∫–∞ –≤ `CustomTokenObtainPairSerializer.validate()`
   - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

4. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - –ü–∞—Ä–æ–ª—å –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –í –ö–û–î–ï

**–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ `backend/users/views.py`:**
- –î–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç `AuthenticationFailed`
- –î–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç `APIException`
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢–µ–ø–µ—Ä—å –≤—Å–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 401 —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.**

---

**–í—ã–ø–æ–ª–Ω–∏—Ç–µ –®–ê–ì 1-3 –∏ –ø—Ä–∏—à–ª–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!**

