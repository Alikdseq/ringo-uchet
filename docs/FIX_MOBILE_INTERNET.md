# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–±–ª–µ–º—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê

**–°–∏–º–ø—Ç–æ–º—ã:**
- ‚úÖ –ù–∞ Wi-Fi –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ª–æ–≥–∏ –∏–¥—É—Ç, —Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå –ù–∞ –º–æ–±–∏–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ:
  - –õ–æ–≥–∏ –Ω–µ –∏–¥—É—Ç (–∑–∞–ø—Ä–æ—Å—ã –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ —Å–µ—Ä–≤–µ—Ä–∞)
  - –ù–µ –º–æ–≥—É –≤–æ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
  - –í Safari —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è, —Ö–æ—Ç—è —Å–∞–π—Ç –ø—Ä–æ–≥—Ä—É–∑–∏–ª—Å—è

---

## ‚úÖ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. **Service Worker —É–ª—É—á—à–µ–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞** (`mobile/web/service-worker.js`)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤:
  - `NETWORK_TIMEOUT = 10s` –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
  - `API_TIMEOUT = 15s` –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
  - `NAVIGATION_TIMEOUT = 8s` –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `fetchWithTimeout()` –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `fetchWithRetry()` —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π:
  - –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏
  - –ó–∞–¥–µ—Ä–∂–∫–∞: 1s, 2s, 4s –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏:
  - –î–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤: Network First —Å retry, –ë–ï–ó –∫—ç—à–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –¥–ª—è POST/PUT/DELETE
  - –î–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏: Network First —Å fallback –Ω–∞ –∫—ç—à
  - –î–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤: Cache First —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –≤ —Ñ–æ–Ω–µ
- ‚úÖ –ù–ï –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã –∫ –¥—Ä—É–≥–∏–º –¥–æ–º–µ–Ω–∞–º (CORS)
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–í–µ—Ä—Å–∏—è –∫—ç—à–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞:** `v1` ‚Üí `v2` (—Å—Ç–∞—Ä—ã–µ –∫—ç—à–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã)

---

### 2. **RetryInterceptor —É–ª—É—á—à–µ–Ω** (`mobile/lib/core/network/interceptors/retry_interceptor.dart`)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ç–∞–π–º–∞—É—Ç–æ–≤:
  - `connectionTimeout`
  - `sendTimeout`
  - `receiveTimeout`
  - `connectionError`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ retry –¥–ª—è:
  - 408 (Request Timeout)
  - 429 (Too Many Requests)
  - 5xx –æ—à–∏–±–æ–∫ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –ø—Ä–∏ retry (+5 —Å–µ–∫—É–Ω–¥ –∑–∞ –∫–∞–∂–¥—É—é –ø–æ–ø—ã—Ç–∫—É)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ Dio –∫–ª–∏–µ–Ω—Ç –¥–ª—è retry (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç interceptors)

---

### 3. **Dio Client –æ–±–Ω–æ–≤–ª–µ–Ω** (`mobile/lib/core/network/dio_client.dart`)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ RetryInterceptor —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞–µ—Ç Dio –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

---

## üöÄ –î–ï–ü–õ–û–ô

### –®–∞–≥ 1: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å Flutter Web

```powershell
cd C:\ringo-uchet\mobile

# –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–±–æ—Ä–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# flutter clean

# –°–æ–±—Ä–∞—Ç—å –¥–ª—è production
flutter build web --release --base-href /
```

### –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
cd /root/ringo-uchet

# –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å scp/sftp –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ build/web/*

# –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /var/www/ringo-uchet
unzip -o build.zip  # –∏–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –Ω–∞–ø—Ä—è–º—É—é

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ
ls -la service-worker.js
```

### –®–∞–≥ 3: –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞

**–í–∞–∂–Ω–æ:** –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω—É–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ –∏ Service Worker:

**–í Chrome/Edge:**
1. `F12` ‚Üí **Application** ‚Üí **Service Workers**
2. –ù–∞–∂–º–∏—Ç–µ **Unregister** –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ Service Worker
3. `F12` ‚Üí **Application** ‚Üí **Clear storage** ‚Üí **Clear site data**

**–í Safari (iOS):**
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Safari ‚Üí –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏ –¥–∞–Ω–Ω—ã–µ –≤–µ–±-—Å–∞–π—Ç–æ–≤
2. –ò–ª–∏: –î–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ‚Üí –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à

**–í Yandex Browser:**
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å ‚Üí –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
2. –í—ã–±–µ—Ä–∏—Ç–µ "–ö—ç—à" –∏ "–°–µ—Ä–≤–∏—Å–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã"

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Service Worker

**–í –±—Ä–∞—É–∑–µ—Ä–µ (DevTools):**

1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://ringoouchet.ru`
2. `F12` ‚Üí **Application** ‚Üí **Service Workers**
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ª–∏ Service Worker v2?
   - –°—Ç–∞—Ç—É—Å: **activated and running**
   - Scope: `https://ringoouchet.ru/`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

**–í –±—Ä–∞—É–∑–µ—Ä–µ (DevTools):**

1. `F12` ‚Üí **Network**
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—Ä–æ—Å—ã:
   - `POST /api/v1/token/` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–¥–µ–Ω
   - –°—Ç–∞—Ç—É—Å: 200 –∏–ª–∏ 401 (–Ω–µ 503)
   - –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: –Ω–µ –±–æ–ª–µ–µ 15 —Å–µ–∫—É–Ω–¥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
cd /root/ringo-uchet/backend
docker compose -f docker-compose.prod.yml logs -f api
```

**–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏:**
- –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è –ª–æ–≥–∏ `Token obtain attempt`
- –ï—Å–ª–∏ –ª–æ–≥–æ–≤ –Ω–µ—Ç - –ø—Ä–æ–±–ª–µ–º–∞ –≤ Service Worker –∏–ª–∏ —Å–µ—Ç–∏

---

## üîß –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–ø—Ä–æ—Å—ã –≤—Å–µ –µ—â–µ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ —Å–µ—Ä–≤–µ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Service Worker v2 –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `service-worker.js` –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Service Worker –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–∞–π–º–∞—É—Ç—ã —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
–£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã –≤ `service-worker.js`:
```javascript
const NETWORK_TIMEOUT = 20000; // 20 —Å–µ–∫—É–Ω–¥
const API_TIMEOUT = 30000; // 30 —Å–µ–∫—É–Ω–¥
```

### –ü—Ä–æ–±–ª–µ–º–∞: Safari –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. Safari –∏–º–µ–µ—Ç –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ Service Worker
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–∞–π—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ HTTPS
3. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à Safari –ø–æ–ª–Ω–æ—Å—Ç—å—é
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ Safari (Safari ‚Üí Develop ‚Üí Service Workers)

---

## ‚úÖ –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
- ‚úÖ –°–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Wi-Fi
- ‚úÖ –°–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
- ‚úÖ –õ–æ–≥–∏ –∏–¥—É—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- ‚úÖ –í—Ö–æ–¥ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ
- ‚úÖ –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ Safari

---

**–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –∏ –ø—Ä–∏—à–ª–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!**

