## Ringo Uchet Monorepo

Корпоративная экосистема для управления арендой спецтехники строится как единый монорепозиторий. Здесь собраны backend (Django REST), мобильное приложение (Flutter), веб-интерфейсы (Next.js) и инфраструктурные артефакты.

### Структура репозитория

| Путь        | Назначение                                                                 |
|-------------|-----------------------------------------------------------------------------|
| `backend/`  | Django REST API, Celery задачи, конфигурация миграций и тестов             |
| `mobile/`   | Flutter-приложение для менеджеров/операторов/админов                       |
| `frontend/` | Next.js маркетинговый сайт + админ SPA                                     |
| `infra/`    | Terraform/Ansible/IaC, CI/CD конфигурации, Helm/Docker файлы               |
| `docs/`     | Архитектура, ERD, API контракты, product backlog, правила разработки       |

Дополнительные каталоги (например `scripts/`, `ops/`) будут добавлены по мере развития.

### Архитектурные ориентиры

- **Backend**: Django + DRF, PostgreSQL, Redis, Celery, S3-совместимое хранилище. JWT auth с RBAC.
- **Mobile**: Flutter (Riverpod/Dio), оффлайн-очередь, push-уведомления (FCM), работа с PDF/картами.
- **Frontend**: Next.js (SSR), админ SPA + публичный сайт, интеграция с API/Charts.
- **Ops**: GitHub Actions/GitLab CI, Docker-based деплой, мониторинг через Sentry/Prometheus/Grafana.

### Git-flow

1. `main` — production-ready код, теги релизов.
2. `staging` (опционально) — кандидаты релиза/preview окружение.
3. `develop` — интеграционная ветка для feature-веток.
4. `feature/<scope>` — рабочие ветки (например, `feature/backend-orders-api`).

Правила:
- PR → `develop` требуют ревью 2х участников и зелёный CI.
- Merge в `main` возможен только через release PR из `staging` или `develop` (по решению релиз-менеджера).
- Используем conventional commits (`feat:`, `fix:`, `chore:` и т.д.).

### Definition of Done

- Код покрыт unit/интеграционными тестами (по модулю ≥ целевого покрытия).
- Линтеры/форматтеры проходят без замечаний.
- Обновлена документация (README, docs/*, Swagger/OpenAPI).
- Добавлены миграции/скрипты для новых схем данных.
- Настроены фиче-флаги/конфиги для разных окружений.
- Обновлены мониторинг/алерты, если затронуты критичные сервисы.
- Проведён code review, замечания устранены.

### Code Review Checklist

- Бизнес-логика соответствует ТЗ и ролям доступа.
- Обработаны edge cases (ошибки API, оффлайн, повторные запросы).
- Нет «захардкоженных» секретов, чувствительные данные читаются из env.
- Производительность: избегаем N+1, используем select_related/prefetch.
- Ошибки логируются с достаточным контекстом, PII маскирована.
- Тесты воспроизводят реальные сценарии и покрывают регрессии.

### ERD и API артефакты

- ERD поддерживаем в `docs/erd/` (диаграмма + описание таблиц, формат PlantUML/Draw.io + экспорт в PNG/PDF).
- API контракты (OpenAPI/Swagger) версионируются в `docs/api/` и автогенерируются из backend.
- Для новых сущностей обязательны: ERD-обновление, OpenAPI, пример payload для Postman/insomnia.

### Product backlog

См. `docs/ProductBacklog.md` — задачи сгруппированы по ролям (админ, менеджер, оператор, бухгалтер, клиент).

---

Следующие шаги: заполнить каталоги сервисным кодом, настраивать CI/CD и инфраструктуру по этапам из `AfinaEcosystemPlan.md`.

