# ๐ ะะฐะบ ัะฐะฑะพัะฐะตั ะทะฐะฟัะพั ะฟะฐัะพะปั - ะฟัะพััะพะต ะพะฑัััะฝะตะฝะธะต

## ๐ฑ ะะพะณะดะฐ ะทะฐะฟัะฐัะธะฒะฐะตััั ะฟะฐัะพะปั?

ะะฐัะพะปั ะทะฐะฟัะฐัะธะฒะฐะตััั ัะพะปัะบะพ ะฒ **3 ัะปััะฐัั**:

### 1๏ธโฃ ะัะธ ะฟะตัะฒะพะผ ะทะฐะฟััะบะต ะฟัะธะปะพะถะตะฝะธั (ะฝะตั ัะพััะฐะฝะตะฝะฝัั ะดะฐะฝะฝัั)

**ะงัะพ ะฟัะพะธััะพะดะธั:**
- ะัะธะปะพะถะตะฝะธะต ะทะฐะฟััะบะฐะตััั
- ะัะพะฒะตััะตั: ะตััั ะปะธ ัะพััะฐะฝะตะฝะฝัะน ัะพะบะตะฝ ะดะพัััะฟะฐ?
- ะัะปะธ **ะะะข ัะพะบะตะฝะฐ** โ ะฟะพะบะฐะทัะฒะฐะตััั ัะบัะฐะฝ ะฒะฒะพะดะฐ ะฟะฐัะพะปั (LoginScreen)

### 2๏ธโฃ ะะพะณะดะฐ ัะพะบะตะฝ ะธััะตะบ ะธ ะฝะต ัะดะฐะปะพัั ะพะฑะฝะพะฒะธัั

**ะงัะพ ะฟัะพะธััะพะดะธั:**
- ะขะพะบะตะฝ ะดะพัััะฟะฐ ะธััะตะบ (ััะฐะป ะฝะตะดะตะนััะฒะธัะตะปัะฝัะผ)
- ะัะธะปะพะถะตะฝะธะต ะฟััะฐะตััั ะพะฑะฝะพะฒะธัั ัะพะบะตะฝ ัะตัะตะท refresh token
- ะัะปะธ refresh token ัะพะถะต ะฝะตะดะตะนััะฒะธัะตะปะตะฝ โ ะพัะธัะฐัััั ะฒัะต ะดะฐะฝะฝัะต โ ะฟะพะบะฐะทัะฒะฐะตััั ัะบัะฐะฝ ะฒะฒะพะดะฐ ะฟะฐัะพะปั

### 3๏ธโฃ ะะพัะปะต ะฒััะพะดะฐ ะธะท ัะธััะตะผั (Logout)

**ะงัะพ ะฟัะพะธััะพะดะธั:**
- ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั "ะัะนัะธ"
- ะัะธัะฐัััั ะฒัะต ัะพััะฐะฝะตะฝะฝัะต ะดะฐะฝะฝัะต (ัะพะบะตะฝั, ะฟะฐัะพะปั, ัะตะปะตัะพะฝ)
- ะะพะบะฐะทัะฒะฐะตััั ัะบัะฐะฝ ะฒะฒะพะดะฐ ะฟะฐัะพะปั

---

## โ ะะพะณะดะฐ ะฟะฐัะพะปั ะะ ะทะฐะฟัะฐัะธะฒะฐะตััั?

### ะะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะพะด ัะฐะฑะพัะฐะตั ะฒ ััะธั ัะปััะฐัั:

1. **ะััั ะดะตะนััะฒัััะธะน ัะพะบะตะฝ ะดะพัััะฟะฐ**
   - ะัะธะปะพะถะตะฝะธะต ะฟัะพะฒะตัะธั ัะพะบะตะฝ
   - ะัะปะธ ัะพะบะตะฝ ะฒะฐะปะธะดะฝัะน โ ััะฐะทั ะพัะบััะฒะฐะตััั ะณะปะฐะฒะฝัะน ัะบัะฐะฝ
   - ะะฐัะพะปั ะะ ะทะฐะฟัะฐัะธะฒะฐะตััั

2. **ะััั ัะพััะฐะฝะตะฝะฝัะต ัะตะปะตัะพะฝ/email ะธ ะฟะฐัะพะปั, ะฝะพ ัะพะบะตะฝ ะธััะตะบ**
   - ะัะธะปะพะถะตะฝะธะต ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะพะฟััะฐะตััั ะฒะพะนัะธ ั ัะพััะฐะฝะตะฝะฝัะผะธ ะดะฐะฝะฝัะผะธ
   - ะัะปะธ ะฒัะพะด ััะฟะตัะตะฝ โ ะพะฑะฝะพะฒะปััััั ัะพะบะตะฝั โ ะณะปะฐะฒะฝัะน ัะบัะฐะฝ
   - ะะฐัะพะปั ะะ ะทะฐะฟัะฐัะธะฒะฐะตััั (ะฒัะพะด ะฟัะพะธััะพะดะธั ะฒ ัะพะฝะต)

---

## ๐ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั ะฟะพัะฐะณะพะฒะพ

### ะจะฐะณ 1: ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั

```
ะัะธะปะพะถะตะฝะธะต ะทะฐะฟััะบะฐะตััั
        โ
AuthNotifier ัะพะทะดะฐะตััั
        โ
ะัะทัะฒะฐะตััั _checkAuthStatus()
```

### ะจะฐะณ 2: ะัะพะฒะตัะบะฐ ัะพะบะตะฝะฐ

```dart
// ะะพะด ะธะท auth_notifier.dart (ัััะพะบะฐ 56-96)

Future<void> _checkAuthStatus() async {
  // 1. ะัะพะฒะตััะตะผ ะตััั ะปะธ ัะพะบะตะฝ ะดะพัััะฟะฐ
  final token = await _secureStorage.getAccessToken();
  
  if (token != null) {
    // โ ะะกะขะฌ ะขะะะะ - ะฟะพะปัะทะพะฒะฐัะตะปั ัะถะต ะฐะฒัะพัะธะทะพะฒะฐะฝ
    // ะะฐะณััะถะฐะตะผ ะดะฐะฝะฝัะต ะธะท ะบััะฐ ะผะณะฝะพะฒะตะฝะฝะพ
    // ะะฐัะตะผ ะพะฑะฝะพะฒะปัะตะผ ั ัะตัะฒะตัะฐ ะฒ ัะพะฝะต
    
  } else {
    // โ ะะะข ะขะะะะะ - ะฝัะถะฝะพ ะฒะพะนัะธ
    // ะัะพะฒะตััะตะผ ะตััั ะปะธ ัะพััะฐะฝะตะฝะฝัะต ะดะฐะฝะฝัะต ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะฒัะพะดะฐ
    final savedPhone = await _secureStorage.getPhone();
    final savedPassword = await _secureStorage.getPassword();
    
    if (savedPassword != null && savedPhone != null) {
      // โ ะััั ัะพััะฐะฝะตะฝะฝัะต ะดะฐะฝะฝัะต - ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะพะด
      await _autoLogin(savedPhone, null, savedPassword);
    } else {
      // โ ะะตั ะดะฐะฝะฝัั - ะฟะพะบะฐะทัะฒะฐะตะผ ัะบัะฐะฝ ะฒะฒะพะดะฐ ะฟะฐัะพะปั
      state = state.copyWith(isAuthenticated: false);
    }
  }
}
```

### ะจะฐะณ 3: ะงัะพ ะฟัะพะธััะพะดะธั ะดะฐะปััะต?

**ะะฐัะธะฐะฝั ะ: ะััั ัะพะบะตะฝ (ะฐะฒัะพัะธะทะพะฒะฐะฝ)**
```
ะขะพะบะตะฝ ะฝะฐะนะดะตะฝ
    โ
ะะฐะณััะถะฐะตะผ ะฟะพะปัะทะพะฒะฐัะตะปั ะธะท ะบััะฐ (ะผะณะฝะพะฒะตะฝะฝะพ)
    โ
ะะพะบะฐะทัะฒะฐะตะผ ะณะปะฐะฒะฝัะน ัะบัะฐะฝ (HomeScreen)
    โ
ะะฑะฝะพะฒะปัะตะผ ะดะฐะฝะฝัะต ั ัะตัะฒะตัะฐ ะฒ ัะพะฝะต
```

**ะะฐัะธะฐะฝั ะ: ะะตั ัะพะบะตะฝะฐ, ะฝะพ ะตััั ัะพััะฐะฝะตะฝะฝัะต ะดะฐะฝะฝัะต**
```
ะะตั ัะพะบะตะฝะฐ, ะฝะพ ะตััั ัะตะปะตัะพะฝ + ะฟะฐัะพะปั
    โ
ะะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะพะด (_autoLogin)
    โ
ะัะฟัะฐะฒะปัะตะผ ะทะฐะฟัะพั ะฝะฐ ัะตัะฒะตั ั ัะพััะฐะฝะตะฝะฝัะผะธ ะดะฐะฝะฝัะผะธ
    โ
ะัะปะธ ััะฟะตัะฝะพ โ ะฟะพะปััะฐะตะผ ะฝะพะฒัะต ัะพะบะตะฝั โ ะณะปะฐะฒะฝัะน ัะบัะฐะฝ
ะัะปะธ ะพัะธะฑะบะฐ โ ะฟะพะบะฐะทัะฒะฐะตะผ ัะบัะฐะฝ ะฒะฒะพะดะฐ ะฟะฐัะพะปั
```

**ะะฐัะธะฐะฝั ะ: ะะตั ะฝะธ ัะพะบะตะฝะฐ, ะฝะธ ัะพััะฐะฝะตะฝะฝัั ะดะฐะฝะฝัั**
```
ะะตั ัะพะบะตะฝะฐ, ะฝะตั ัะพััะฐะฝะตะฝะฝัั ะดะฐะฝะฝัั
    โ
ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ isAuthenticated = false
    โ
app.dart ะฒะธะดะธั isAuthenticated = false
    โ
ะะพะบะฐะทัะฒะฐะตะผ LoginScreen (ัะบัะฐะฝ ะฒะฒะพะดะฐ ะฟะฐัะพะปั)
```

---

## ๐ฏ ะะดะต ะฟัะธะฝะธะผะฐะตััั ัะตัะตะฝะธะต ะฟะพะบะฐะทัะฒะฐัั ัะบัะฐะฝ ะฒะฒะพะดะฐ ะฟะฐัะพะปั?

### ะ ัะฐะนะปะต `app.dart` (ัััะพะบะฐ 152-183):

```dart
final authState = ref.watch(authStateProvider);

return MaterialApp(
  home: authState.isAuthenticated
      ? const _HomeScreen()  // โ ะะฒัะพัะธะทะพะฒะฐะฝ โ ะณะปะฐะฒะฝัะน ัะบัะฐะฝ
      : const LoginScreen(),  // โ ะะ ะฐะฒัะพัะธะทะพะฒะฐะฝ โ ัะบัะฐะฝ ะฒะฒะพะดะฐ ะฟะฐัะพะปั
);
```

**ะัะพัััะผะธ ัะปะพะฒะฐะผะธ:**
- ะัะปะธ `isAuthenticated = true` โ ะฟะพะบะฐะทัะฒะฐะตะผ ะณะปะฐะฒะฝัะน ัะบัะฐะฝ
- ะัะปะธ `isAuthenticated = false` โ ะฟะพะบะฐะทัะฒะฐะตะผ ัะบัะฐะฝ ะฒะฒะพะดะฐ ะฟะฐัะพะปั

---

## ๐พ ะะดะต ััะฐะฝัััั ะดะฐะฝะฝัะต?

### SecureStorage (ะฑะตะทะพะฟะฐัะฝะพะต ััะฐะฝะธะปะธัะต)

1. **ะขะพะบะตะฝ ะดะพัััะฟะฐ (access token)** - ะธัะฟะพะปัะทัะตััั ะดะปั ะฐะฒัะพัะธะทะฐัะธะธ ะทะฐะฟัะพัะพะฒ
2. **Refresh token** - ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั access token ะบะพะณะดะฐ ะพะฝ ะธััะตัะตั
3. **ะขะตะปะตัะพะฝ/Email** - ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะฒัะพะดะฐ
4. **ะะฐัะพะปั** - ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะฒัะพะดะฐ (ััะฐะฝะธััั ะฒ ะทะฐัะธััะพะฒะฐะฝะฝะพะผ ะฒะธะดะต)
5. **ะะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั** - ะธะผั, ัะพะปั ะธ ั.ะด. (ะดะปั ะฑััััะพะณะพ ะพัะพะฑัะฐะถะตะฝะธั)

### ะงัะพ ะฟัะพะธััะพะดะธั ะฟัะธ ััะฟะตัะฝะพะผ ะฒัะพะดะต?

```dart
// ะะพะด ะธะท auth_notifier.dart (ัััะพะบะฐ 162-246)

Future<void> login(LoginRequest request) async {
  // 1. ะัะฟัะฐะฒะปัะตะผ ะทะฐะฟัะพั ะฝะฐ ัะตัะฒะตั
  final authResponse = await _authService.login(request);
  
  // 2. ะกะพััะฐะฝัะตะผ ัะพะบะตะฝั
  await _secureStorage.saveAccessToken(authResponse.access);
  await _secureStorage.saveRefreshToken(authResponse.refresh);
  
  // 3. ะกะพััะฐะฝัะตะผ ัะตะปะตัะพะฝ/email ะธ ะฟะฐัะพะปั ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะฒัะพะดะฐ
  await _secureStorage.savePhone(request.phone!);
  await _secureStorage.savePassword(request.password);
  
  // 4. ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ isAuthenticated = true
  state = state.copyWith(isAuthenticated: true, user: ...);
}
```

---

## ๐ ะะฑะฝะพะฒะปะตะฝะธะต ัะพะบะตะฝะฐ (refresh)

ะะพะณะดะฐ ัะพะบะตะฝ ะธััะตะบะฐะตั:

```dart
// ะะพะด ะธะท auth_notifier.dart (ัััะพะบะฐ 120-159)

Future<void> _refreshUserInBackground() async {
  try {
    // ะััะฐะตะผัั ะฟะพะปััะธัั ะดะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั
    final user = await _authService.getCurrentUser();
  } catch (e) {
    if (e is UnauthorizedException) {
      // ะขะพะบะตะฝ ะฝะตะดะตะนััะฒะธัะตะปะตะฝ โ ะฟััะฐะตะผัั ะพะฑะฝะพะฒะธัั
      final refreshed = await refreshToken();
      
      if (refreshed) {
        // โ ะฃัะฟะตัะฝะพ ะพะฑะฝะพะฒะธะปะธ โ ะฟัะพะดะพะปะถะฐะตะผ ัะฐะฑะพัั
      } else {
        // โ ะะต ัะดะฐะปะพัั ะพะฑะฝะพะฒะธัั โ ะพัะธัะฐะตะผ ะฒัะต โ ะฟะพะบะฐะทัะฒะฐะตะผ ัะบัะฐะฝ ะฒะฒะพะดะฐ ะฟะฐัะพะปั
        await _secureStorage.clearAll();
        state = state.copyWith(isAuthenticated: false);
      }
    }
  }
}
```

---

## ๐ ะกัะตะผะฐ ัะฐะฑะพัั (ะฟัะพัััะผะธ ัะปะพะฒะฐะผะธ)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั                     โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โผ
      โโโโโโโโโโโโโโโโโโ
      โ ะััั ัะพะบะตะฝ?    โ
      โโโโโฌโโโโโโโโโฌโโโโ
          โ        โ
      ะะ  โ        โ  ะะะข
          โ        โ
          โผ        โผ
    โโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ
    โะะปะฐะฒะฝัะน  โ  โ ะััั ัะพััะฐะฝะตะฝะฝัะต    โ
    โัะบัะฐะฝ    โ  โ ัะตะปะตัะพะฝ + ะฟะฐัะพะปั?   โ
    โโโโโโโโโโโ  โโโโโฌโโโโโโโโโโโโโโฌโโโโ
                     โ             โ
                  ะะ โ             โ ะะะข
                     โ             โ
                     โผ             โผ
               โโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ
               โะะฒัะพะผะฐัะธั.โ  โะญะบัะฐะฝ ะฒะฒะพะดะฐ   โ
               โะฒัะพะด      โ  โะฟะฐัะพะปั        โ
               โโโโโโฌโโโโโโ  โโโโโโโโโโโโโโโโ
                    โ
                    โผ
               ะฃัะฟะตัะฝะพ?
                    โ
          โโโโโโโโโโโดโโโโโโโโโโ
          โ                   โ
        ะะ โ                   โ ะะะข
          โ                   โ
          โผ                   โผ
    โโโโโโโโโโโโ       โโโโโโโโโโโโโโโโ
    โะะปะฐะฒะฝัะน   โ       โะญะบัะฐะฝ ะฒะฒะพะดะฐ   โ
    โัะบัะฐะฝ     โ       โะฟะฐัะพะปั        โ
    โโโโโโโโโโโโ       โโโโโโโโโโโโโโโโ
```

---

## ๐ฏ ะัะพะณะพะฒัะต ะฒัะฒะพะดั

1. **ะะฐัะพะปั ะทะฐะฟัะฐัะธะฒะฐะตััั ัะพะปัะบะพ ะบะพะณะดะฐ:**
   - ะะตั ัะพะบะตะฝะฐ ะ ะฝะตั ัะพััะฐะฝะตะฝะฝัั ะดะฐะฝะฝัั ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะฒัะพะดะฐ
   - ะขะพะบะตะฝ ะธััะตะบ ะ ะฝะต ัะดะฐะปะพัั ะตะณะพ ะพะฑะฝะพะฒะธัั
   - ะะพะปัะทะพะฒะฐัะตะปั ะฒััะตะป ะธะท ัะธััะตะผั

2. **ะะฐัะพะปั ะะ ะทะฐะฟัะฐัะธะฒะฐะตััั ะบะพะณะดะฐ:**
   - ะััั ะดะตะนััะฒัััะธะน ัะพะบะตะฝ (ัะฐะผัะน ัะฐัััะน ัะปััะฐะน)
   - ะััั ัะพััะฐะฝะตะฝะฝัะต ะดะฐะฝะฝัะต ะธ ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะพะด ััะฟะตัะตะฝ

3. **ะะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะพะด ัะฐะฑะพัะฐะตั ัะฐะบ:**
   - ะัะธะปะพะถะตะฝะธะต ัะพััะฐะฝัะตั ัะตะปะตัะพะฝ ะธ ะฟะฐัะพะปั ะฟะพัะปะต ะฟะตัะฒะพะณะพ ััะฟะตัะฝะพะณะพ ะฒัะพะดะฐ
   - ะัะธ ัะปะตะดัััะตะผ ะทะฐะฟััะบะต, ะตัะปะธ ัะพะบะตะฝะฐ ะฝะตั, ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฒัะพะดะธั ั ัะพััะฐะฝะตะฝะฝัะผะธ ะดะฐะฝะฝัะผะธ
   - ะะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั ัะพะปัะบะพ ะณะปะฐะฒะฝัะน ัะบัะฐะฝ ะฑะตะท ะทะฐะฟัะพัะฐ ะฟะฐัะพะปั

4. **ะะตะทะพะฟะฐัะฝะพััั:**
   - ะขะพะบะตะฝั ััะฐะฝัััั ะฒ ะฑะตะทะพะฟะฐัะฝะพะผ ััะฐะฝะธะปะธัะต (SecureStorage)
   - ะะฐัะพะปั ัะพะถะต ััะฐะฝะธััั ะฑะตะทะพะฟะฐัะฝะพ (ะทะฐัะธััะพะฒะฐะฝ)
   - ะัะธ ะฒััะพะดะต ะฒัะต ะดะฐะฝะฝัะต ะพัะธัะฐัััั

---

## ๐ ะะดะต ะฟะพัะผะพััะตัั ะบะพะด?

- **ะัะพะฒะตัะบะฐ ะฐะฒัะพัะธะทะฐัะธะธ:** `mobile/lib/features/auth/notifiers/auth_notifier.dart` (ะผะตัะพะด `_checkAuthStatus`, ัััะพะบะฐ 56)
- **ะะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะพะด:** `mobile/lib/features/auth/notifiers/auth_notifier.dart` (ะผะตัะพะด `_autoLogin`, ัััะพะบะฐ 98)
- **ะะพะณะธะฝ:** `mobile/lib/features/auth/notifiers/auth_notifier.dart` (ะผะตัะพะด `login`, ัััะพะบะฐ 162)
- **ะะตัะตะฝะธะต ะบะฐะบะพะน ัะบัะฐะฝ ะฟะพะบะฐะทะฐัั:** `mobile/lib/app.dart` (ัััะพะบะฐ 152-183)
- **ะญะบัะฐะฝ ะฒะฒะพะดะฐ ะฟะฐัะพะปั:** `mobile/lib/features/auth/screens/login_screen.dart`

