# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏ –ø—Ä–∏ VPN

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å VPN:
- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚úÖ
- –î–∞–Ω–Ω—ã–µ –¥–æ–ª–≥–æ –≥—Ä—É–∑—è—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞ ‚ùå
- –ü–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞ "–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è" ‚ùå
- –î–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è ‚ùå

## üîß –†–µ—à–µ–Ω–∏–µ

### 1. –£–≤–µ–ª–∏—á–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–§–∞–π–ª:** `mobile/lib/core/constants/app_constants.dart`

- **–ë–∞–∑–æ–≤—ã–π —Ç–∞–π–º–∞—É—Ç:** 30 ‚Üí **60 —Å–µ–∫—É–Ω–¥** (–¥–ª—è –æ–±—ã—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- **–¢–∞–π–º–∞—É—Ç –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏:** **90 —Å–µ–∫—É–Ω–¥** (–Ω–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö)
- –≠—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏

### 2. –î–æ–±–∞–≤–ª–µ–Ω —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª:** `mobile/lib/app.dart` - –º–µ—Ç–æ–¥ `_preloadData()`

- –î–æ–±–∞–≤–ª–µ–Ω –æ–±—â–∏–π —Ç–∞–π–º–∞—É—Ç 90 —Å–µ–∫—É–Ω–¥ –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏
- –ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –∫—ç—à–∞
- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—ç—à

### 3. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö

**–§–∞–π–ª—ã:**
- `mobile/lib/features/orders/services/order_service.dart`
- `mobile/lib/features/catalog/services/catalog_service.dart`

**–£–ª—É—á—à–µ–Ω–∏—è:**
- –ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ (`connectionTimeout`, `receiveTimeout`, `sendTimeout`) —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—ç—à
- –†–∞–Ω—å—à–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `connectionError` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –∫—ç—à
- –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ª—é–±–æ–º —Ç–∞–π–º–∞—É—Ç–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏

### 4. –£–ª—É—á—à–µ–Ω–∞ retry –ª–æ–≥–∏–∫–∞

**–§–∞–π–ª:** `mobile/lib/core/network/interceptors/retry_interceptor.dart`

- –£–≤–µ–ª–∏—á–µ–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É retry: 1s, 2s, 4s ‚Üí **2s, 4s, 8s**
- –≠—Ç–æ –¥–∞—ë—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

---

## üìù –î–µ—Ç–∞–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`app_constants.dart`)

```dart
static const int defaultTimeoutSeconds = 60; // –ë—ã–ª–æ: 30
static const int preloadTimeoutSeconds = 90; // –ù–æ–≤–æ–µ
```

### –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (`app.dart`)

```dart
await Future.wait([...]).timeout(
  const Duration(seconds: AppConstants.preloadTimeoutSeconds),
  onTimeout: () {
    // –ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—ã–µ —Å–ø–∏—Å–∫–∏
    // –°–µ—Ä–≤–∏—Å—ã —Å–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫—ç—à –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
    return [...];
  },
);
```

### –°–µ—Ä–≤–∏—Å—ã (order_service, catalog_service)

```dart
} on DioException catch (e) {
  // –£–õ–£–ß–®–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤
  if (e.type == DioExceptionType.connectionError ||
      e.type == DioExceptionType.connectionTimeout ||
      e.type == DioExceptionType.receiveTimeout ||
      e.type == DioExceptionType.sendTimeout ||
      e.error is SocketException) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏
    final cached = await cacheService.getCachedXXX();
    if (cached != null && cached.isNotEmpty) {
      return cached;
    }
  }
  throw _handleError(e);
}
```

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

‚úÖ **–¢–∞–π–º–∞—É—Ç—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã –¥–ª—è VPN** (60-90 —Å–µ–∫—É–Ω–¥)  
‚úÖ **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç** - –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—ç—à  
‚úÖ **–ù–µ—Ç –æ—à–∏–±–æ–∫ "–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è"** - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ  
‚úÖ **–î–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è** - –ª–∏–±–æ —Å —Å–µ—Ä–≤–µ—Ä–∞, –ª–∏–±–æ –∏–∑ –∫—ç—à–∞  
‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ** - –∫–æ–≥–¥–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É–ª—É—á—à–∏—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å

### –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å VPN:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥** ‚Üí —É—Å–ø–µ—à–Ω–æ
2. **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö** ‚Üí –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
3. **–ï—Å–ª–∏ —Ç–∞–π–º–∞—É—Ç (90 —Å–µ–∫)** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—ç—à (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. **–ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω** ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞
5. **–≠–∫—Ä–∞–Ω—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è** ‚Üí –∑–∞–≥—Ä—É–∂–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
6. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ** ‚Üí –∫–æ–≥–¥–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É–ª—É—á—à–∏—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤—è—Ç—Å—è

### –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —ç–∫—Ä–∞–Ω–æ–≤:

1. **–≠–∫—Ä–∞–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è** ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
2. **–ü–æ–ø—ã—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–∞** ‚Üí –µ—Å–ª–∏ —Ç–∞–π–º–∞—É—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—ç—à
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ** ‚Üí –≤—Å–µ–≥–¥–∞, –±–µ–∑ –æ—à–∏–±–æ–∫

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –¢–∞–π–º–∞—É—Ç—ã —É–≤–µ–ª–∏—á–µ–Ω—ã, –Ω–æ –Ω–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã - —ç—Ç–æ –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é –∏ —Å–∫–æ—Ä–æ—Å—Ç—å—é
- –ö—ç—à –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±—ã—Ö –æ—à–∏–±–∫–∞—Ö —Å–µ—Ç–∏/—Ç–∞–π–º–∞—É—Ç–∞—Ö
- –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ñ–æ–Ω–µ –∫–æ–≥–¥–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É–ª—É—á—à–∏—Ç—Å—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ - –ª–∏–±–æ —Å–≤–µ–∂–∏–µ, –ª–∏–±–æ –∏–∑ –∫—ç—à–∞

---

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **–ë–∞–∑–æ–≤—ã–π —Ç–∞–π–º–∞—É—Ç:** 60 —Å–µ–∫—É–Ω–¥ (2x —É–≤–µ–ª–∏—á–µ–Ω–∏–µ)
- **–¢–∞–π–º–∞—É—Ç –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏:** 90 —Å–µ–∫—É–Ω–¥ (–Ω–æ–≤—ã–π)
- **Retry –∑–∞–¥–µ—Ä–∂–∫–∏:** 2s, 4s, 8s (—É–≤–µ–ª–∏—á–µ–Ω—ã)
- **Fallback –Ω–∞ –∫—ç—à:** –ø—Ä–∏ –≤—Å–µ—Ö —Ç–∏–ø–∞—Ö —Ç–∞–π–º–∞—É—Ç–æ–≤

---

## ‚úÖ –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. `mobile/lib/core/constants/app_constants.dart` - —Ç–∞–π–º–∞—É—Ç—ã
2. `mobile/lib/app.dart` - –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
3. `mobile/lib/features/orders/services/order_service.dart` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤
4. `mobile/lib/features/catalog/services/catalog_service.dart` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤
5. `mobile/lib/core/network/interceptors/retry_interceptor.dart` - retry –ª–æ–≥–∏–∫–∞

