## üåê –°–≤—è–∑–∫–∞ React Web —Ñ—Ä–æ–Ω—Ç–∞ —Å backend –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏ –∏ –ø–æ–ª–∏—Ç–∏–∫–∞ CORS/CSRF

–î–æ–∫—É–º–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —à–∞–≥ **W0.4** –∏–∑ `ReactWebFrontendPlan.md`:  
–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã base URL –ø–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `.env` –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞ –∏ –ø–æ–¥—Ö–æ–¥ –∫ CORS/CSRF —Å —É—á—ë—Ç–æ–º —Ç–µ–∫—É—â–µ–≥–æ Django/DRF backend –∏ JWT‚Äë–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

---

## 1. Base URL backend –ø–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º

–û–ø–∏—Ä–∞–µ–º—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é Flutter‚Äë–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `AppConfig`:

- **Dev**:
  - `apiBaseUrl = 'http://localhost:8001'`
  - `apiVersion = 'v1'`
  - –ò—Ç–æ–≥–æ–≤—ã–π API URL: `http://localhost:8001/api/v1`
- **Stage**:
  - `apiBaseUrl = 'https://api.ringo.stage'`
  - `apiVersion = 'v1'`
  - –ò—Ç–æ–≥–æ–≤—ã–π API URL: `https://api.ringo.stage/api/v1`
- **Prod**:
  - `apiBaseUrl = 'https://ringoouchet.ru'`
  - `apiVersion = 'v1'`
  - –ò—Ç–æ–≥–æ–≤—ã–π API URL: `https://ringoouchet.ru/api/v1`

–î–ª—è —Ñ—Ä–æ–Ω—Ç–∞ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ **–±–∞–∑–æ–≤—ã–µ URL –¥–ª—è Axios/React Query**.

---

## 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ .env —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞

–î–ª—è Next.js frontend –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–≤ –∫–æ—Ä–Ω–µ `frontend/`):

- `.env.development` ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞.
- `.env.staging` ‚Äî staging –æ–∫—Ä—É–∂–µ–Ω–∏–µ (pre‚Äëprod).
- `.env.production` ‚Äî prod –æ–∫—Ä—É–∂–µ–Ω–∏–µ.

### 2.1 –û–±—â–∏–π —Ñ–æ—Ä–º–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `NEXT_PUBLIC_` –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ.  
–í–æ–∑–º–æ–∂–Ω—ã–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä:

- `NEXT_PUBLIC_API_BASE_URL` ‚Äî –±–∞–∑–æ–≤—ã–π URL API (—Å `/api/v1` –Ω–∞ –∫–æ–Ω—Ü–µ).
- `NEXT_PUBLIC_ENV` ‚Äî —Å—Ç—Ä–æ–∫–æ–≤—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–∫—Ä—É–∂–µ–Ω–∏—è (`development` / `staging` / `production`).
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ–∑–∂–µ) `NEXT_PUBLIC_SENTRY_DSN`, `NEXT_PUBLIC_SENTRY_ENVIRONMENT`, –∏ —Ç.–¥.

### 2.2 –ü—Ä–∏–º–µ—Ä—ã —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ

#### `.env.development`

```bash
NEXT_PUBLIC_API_BASE_URL=http://localhost:8001/api/v1
NEXT_PUBLIC_ENV=development
```

#### `.env.staging`

```bash
NEXT_PUBLIC_API_BASE_URL=https://api.ringo.stage/api/v1
NEXT_PUBLIC_ENV=staging
```

#### `.env.production`

```bash
NEXT_PUBLIC_API_BASE_URL=https://ringoouchet.ru/api/v1
NEXT_PUBLIC_ENV=production
```

> –ö–æ–≥–¥–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø—Ä–æ–µ–∫—Ç `frontend/`, —ç—Ç–∏ —Ñ–∞–π–ª—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `.gitignore`, –∞ –∏—Ö –ø—Ä–∏–º–µ—Ä—ã ‚Äî –≤ `frontend/.env.example`.

---

## 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ base URL –≤–æ —Ñ—Ä–æ–Ω—Ç–µ

- –í `src/shared/api/httpClient.ts` (Axios –∏–Ω—Å—Ç–∞–Ω—Å):
  - `baseURL = process.env.NEXT_PUBLIC_API_BASE_URL`.
  - –¢–∞–π–º–∞—É—Ç—ã –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —ç—Ç–æ–≥–æ URL.
- –í–æ –≤—Å–µ—Ö API‚Äë—Å–µ—Ä–≤–∏—Å–∞—Ö (`AuthApi`, `OrdersApi`, `CatalogApi`, `ReportsApi`, –∏ –¥—Ä.):
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—â–∏–π Axios‚Äë–∏–Ω—Å—Ç–∞–Ω—Å ‚Äî –º–∞—Ä—à—Ä—É—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π (`/orders/`, `/reports/summary/`), –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è `api/v1`.

---

## 4. CORS‚Äë–ø–æ–ª–∏—Ç–∏–∫–∞

### 4.1 –û–±—â–∏–π –ø–æ–¥—Ö–æ–¥

- –§—Ä–æ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **JWT –≤ HTTP‚Äë–∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`**, –∞ **–Ω–µ cookie**.
- –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
  - –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç CSRF‚Äëcookie –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ.
  - CORS‚Äë–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ backend –¥–æ–ª–∂–Ω—ã —Ä–∞–∑—Ä–µ—à–∞—Ç—å:
    - `Authorization` –∑–∞–≥–æ–ª–æ–≤–æ–∫.
    - `Content-Type: application/json`.
    - `Accept: application/json`.

### 4.2 –û–∂–∏–¥–∞–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Django/DRF (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ)

–ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ backend (Django + `django-cors-headers`):

- `CORS_ALLOW_CREDENTIALS = False` (–º—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º cookie‚Äëauth).
- `CORS_ALLOW_HEADERS` –≤–∫–ª—é—á–∞–µ—Ç:
  - `Authorization`
  - `Content-Type`
  - `Accept`
  - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞.
- `CORS_ALLOWED_ORIGINS` (–∏–ª–∏ `CORS_ALLOWED_ORIGIN_REGEXES`) –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å **origin‚Äë—ã —Ñ—Ä–æ–Ω—Ç–∞**:
  - Dev:
    - `http://localhost:3000` (Next.js dev server).
  - Stage:
    - –¥–æ–º–µ–Ω staging —Ñ—Ä–æ–Ω—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä: `https://<STAGE_FRONTEND_DOMAIN>` (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –ø—Ä–∏ –¥–µ–ø–ª–æ–µ).
  - Prod:
    - –ø—Ä–æ–¥‚Äë–¥–æ–º–µ–Ω —Ñ—Ä–æ–Ω—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä: `https://<PROD_FRONTEND_DOMAIN>` (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∏–º—è –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –¥–æ–º–µ–Ω–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä `app.ringoouchet.ru`).

> –í–∞–∂–Ω–æ: backend –æ—Å—Ç–∞—ë—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å –ø–æ –∫–æ–¥—É, –Ω–æ **–Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–¥–∞–Ω—ã CORS‚Äëorigin‚Äô—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.

---

## 5. CSRF‚Äë–ø–æ–ª–∏—Ç–∏–∫–∞

### 5.1 –ü–æ—á–µ–º—É CSRF –º–æ–∂–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —è–≤–Ω–æ–º –≤–∏–¥–µ

- –ú—ã **–Ω–µ** –∏—Å–ø–æ–ª—å–∑—É–µ–º cookie‚Äëauth (—Å–µ—Å—Å–∏–æ–Ω–Ω—ã–µ cookie –∏–ª–∏ JWT –≤ cookie).
- –í—Å–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ **Bearer‚Äë—Ç–æ–∫–µ–Ω—ã –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ**, –∫–æ—Ç–æ—Ä—ã–µ:
  - –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–∞–π—Ç—ã.
  - –ù–µ –ø–æ–¥–≤–µ—Ä–∂–µ–Ω—ã –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π CSRF‚Äë–∞—Ç–∞–∫–µ (—Ç—Ä–µ–±—É—é—â–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ cookie).

–°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:

- –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ **–Ω–µ –Ω—É–∂–Ω–æ** —É–ø—Ä–∞–≤–ª—è—Ç—å CSRF‚Äë—Ç–æ–∫–µ–Ω–∞–º–∏.
- –ù–∞ backend:
  - –î–ª—è API‚Äë–≤—å—é (DRF + SimpleJWT) –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å CSRF‚Äë–ø—Ä–æ–≤–µ—Ä–∫—É (`CSRF exempt`) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SessionAuthentication` —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ.

### 5.2 –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- –í Axios:
  - –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `withCredentials: true` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`), —á—Ç–æ–±—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å cookie.
- –í Django:
  - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ DRF‚ÄëAPIView/ViewSet‚Äô—ã, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å JWT, –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç CSRF‚Äëcookie.

---

## 6. –ò—Ç–æ–≥

- Base URL –¥–ª—è –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å —Ç–µ–∫—É—â–µ–π Flutter‚Äë–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π `AppConfig`.
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `.env.*` –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞ (`NEXT_PUBLIC_API_BASE_URL`, `NEXT_PUBLIC_ENV`), –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ Next.js.
- CORS‚Äë–ø–æ–ª–∏—Ç–∏–∫–∞ –≤—ã—Å—Ç—Ä–æ–µ–Ω–∞ –≤–æ–∫—Ä—É–≥:
  - –Ø–≤–Ω–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö origin‚Äô–æ–≤ —Ñ—Ä–æ–Ω—Ç–∞.
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è JWT –≤ `Authorization` –∑–∞–≥–æ–ª–æ–≤–∫–µ.
- CSRF –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ cookie‚Äëbased; –Ω–∞ backend –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å CSRF‚Äë–∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è JWT‚ÄëAPI.


